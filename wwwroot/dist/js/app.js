!function(t,e,a){function n(){t.getJSON("../locations.json",function(e){C=e;var i=0;t.each(e.states,function(){var a=t(this)[0],n="#"+a.abbrev,o=t(n);k.push(o);var s=l(a);s&&i==e.states.length-1&&t("#detailPanelTemplate").remove(),i++}),o()})}function o(){t(".scaling-svg-container").css("visibility","visible"),L=!0,M.fromTo(t(".dice > img"),1,{scale:0,rotation:-90},{scale:1,rotation:0,ease:Power3.easeOut},0),M.staggerTo(k,.4,{scale:1,ease:Back.easeOut},.2),M.addLabel("afterStates"),M.staggerFrom(t(".pin.red"),.7,{top:-1*t(".scaling-svg-container").offset().top-200,ease:Power3.easeOut},.2);var e=document.getElementById("riverPath"),i={length:0,pathLength:1300.1239013671875};M.to(i,3,{length:i.pathLength,onStart:function(){e.style.display="block"},onUpdate:s,onUpdateParams:[i,e],ease:Linear.easeNone},"afterStates")}function s(t,e){e.style.strokeDasharray=[t.length,t.pathLength].join(" ")}function c(a){if(!L&&!R){a.attr("data-active","1"),I.state=a.attr("id");var n=document.getElementById(I.state),o=n.getBoundingClientRect().width,s=(n.getBoundingClientRect().height,a.offset());t("#test");T&&t(".panel").each(function(){t(this).attr("data-state")==I.state?t(this).fadeIn():t(this).fadeOut()}),x=t("#overlay"+I.state).css({left:s.left,top:s.top+document.getElementById("container").scrollTop,width:o,opacity:0}),R=!0,_=new TimelineLite({onComplete:function(){var n=a.attr("data-x"),o=a.attr("data-y"),s=a.attr("data-scale"),c=100;if(T)switch(a.attr("id")){case"IL":s=50,c=70,n=30;case"MS":s=50,c=20,n=30;break;default:s=80}x.css({opacity:1,display:"block"}),a.css({opacity:0,display:"none"});var r=0;r=.2;var l=t(".svgContainer").offset(),d=t(".svgContainer").width(),h=t(".svgContainer").height(),f=(d*(n/100)+l.left)/t(e).width()*100,u=(h*(o/100)+l.top+document.getElementById("container").scrollTop)/t(e).height()*100;if(T){var m=document.getElementById("logo").getBoundingClientRect();u=m.top+m.height+document.body.scrollTop+c}else u+="%";TweenMax.to(x,r,{width:s+"%",left:f+"%",top:u,svgOrigin:"0 0",onComplete:function(){for(i=0;i<C.states.length;i++)if(a.attr("id")==C.states[i].abbrev)return I.pins=C.states[i].pins,p(),void g()}})},onReverseComplete:function(){TweenLite.to(a,0,{opacity:1,display:"block"}),x.css({left:-1e3,top:-1e3})}}),_.to(t("#river, .pin.red"),.5,{opacity:0,display:"none"}),_.to(t(".closeMap"),0,{display:"block"}),t(".state").each(function(){if(0==t(this).attr("data-active")){t(this).css("z-index",10);var e=0;e=.3,_.to(t(this),e,{scale:0,ease:Back.easeIn},0)}})}}function r(){if(t(".panel").show(),T?(t("body").scrollTo(t("#svgMap"),600),t(".panel").hide()):t("body").scrollTo(0,0),t("#"+I.state).attr("data-active","0"),T||TweenLite.to(t("#details"),.5,{right:"-100%"}),R=!1,E=!1,void 0!==I.state){var e=document.getElementById(I.state),i=e.getBoundingClientRect().width,a=(e.getBoundingClientRect().height,t("#"+I.state).offset()),n=a.top+document.getElementById("container").scrollTop;B.reverse(),TweenMax.to(x,.2,{width:i,left:a.left,top:n,onComplete:function(){_.reverse()}})}}function l(e){var i=0,a=e.pins,n=["club","spade","heart","diamond"];return t.each(a,function(){var a=t(this)[0],o=t("<div>").addClass("pin pin_"+e.abbrev).attr({"data-pinid":i,"data-state":e.abbrev,"data-x":t(this)[0].x,"data-y":t(this)[0].y,"data-pinname":t(this)[0].name.replace(/ /g,"").replace(/'/g,"").toLowerCase()}).append("<img src='images/"+n[i%4]+".png' />");t(".container").append(o);var s=t("#detailPanelTemplate").clone(!0).attr({id:"panel_"+e.abbrev+"_"+i,"data-state":e.abbrev,"data-id":i});if(t(".city",s).text(a.city+", "+e.state),t(".a1",s).text(a.name),t(".a2",s).text(a.address),t(".a3",s).text(a.city+", "+e.abbrev+", "+a.zip),""==a.ytid?t(".video",s).hide():t(".video",s).on("click",function(){t.fancybox.open({href:"http://www.youtube.com/embed/"+a.ytid+"?autoplay=1"},{type:"iframe",padding:4,margin:40})}),a.images.length){for(var c=[],r=0;r<a.images.length;r++){var l={href:"images/locations/"+a.images[r]};c.push(l)}t(".photo, .thumb",s).on("click",function(){t.fancybox.open(c,{padding:0,margin:[40,100,40,100]})})}else t(".photo",s).hide();t(".link a",s).attr({href:a.url,target:"_blank"}),t(".fb a",s).attr({href:"https://www.facebook.com/sharer.php?u="+encodeURIComponent(window.location.origin+"?l="+o.attr("data-pinname")),target:"_blank"});var d=window.location.origin+"?l="+o.attr("data-pinname");w(d,S,j,function(e){t(".twttr a",s).attr({href:"https://www.twitter.com/share?text="+P+"&url="+e,target:"_blank"})}),""==a.thumb?t(".thumb",s).hide():t(".thumb",s).html('<img src="/images/thumbs/'+a.thumb+'" />'),t("#details").append(s),i++}),!0}function d(){var t=(document.getElementById("river").getBoundingClientRect(),document.getElementById("svgMap").getBoundingClientRect()),e=.466*t.width,i=2.44505907782121*e,a=t.left+.2849869862426*t.width-document.getElementById("container").getBoundingClientRect().left;document.getElementById("river").style.width=e+"px",document.getElementById("river").style.height=i+"px",document.getElementById("river").style.left=a+"px",document.getElementById("river").style.top=t.top-.122*t.height+document.body.scrollTop+"px"}function p(){var e=document.getElementById("overlay"+I.state),i=e.getBoundingClientRect().width,a=e.getBoundingClientRect().height,n=x.offset();t.each(t(".pin_"+I.state),function(){var e=i*t(this).attr("data-x"),o=a*t(this).attr("data-y"),s=n.left+e-t(this).width()/2-document.getElementById("container").getBoundingClientRect().left,c=n.top+document.getElementById("container").scrollTop+o-t(this).height();t(this).css({left:s,top:c})})}function g(){B=new TimelineLite({onReverseComplete:function(){this.clear()},onComplete:function(){T||N||e[0].trigger("click"),N=!1}});var e=[];t.each(t(".pin_"+I.state),function(){e.push(t(this))}),N||(t(".pin").removeClass("active"),e[0].addClass("active")),B.staggerFrom(e,.5,{top:-100},.1).to(t(this),.5,{alpha:1},.5)}function h(){if(t(".pin").removeClass("active"),t(this).addClass("active"),t(this).hasClass("red")){var e=t(this).attr("data-parent").toUpperCase();return void t("#"+e).trigger("click")}var i=t(this),a=i.attr("data-state"),n=i.attr("data-pinid"),o=t("#panel_"+a+"_"+n);return T?(t("body").scrollTo(o,600),void(N=!1)):(E?TweenLite.to(t("#details"),.5,{right:"-100%",onComplete:function(){f(o)}}):f(o),void(E=!0))}function f(e){T||(u(),e.css("visibility","visible"),TweenLite.to(t("#details"),.5,{right:"3%"}))}function u(){t(".panel").css("visibility","hidden")}function m(){U=!0;var e=new TimelineLite({onComplete:function(){U&&m()}});e.to(t(".pokerChip"),.25,{scaleY:-1,ease:Linear.easeNone}),e.to(t(".pokerChip"),.25,{scaleY:1,ease:Linear.easeNone})}function v(){var e=y("l");if(null!==e&&""!=e){var i=t('.pin[data-pinname="'+e.toLowerCase()+'"');if(null!==e||i.length){N=!0;var a=t("#"+i.attr("data-state"));a.trigger("click"),i.trigger("click")}}}function y(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null===i?"":decodeURIComponent(i[1].replace(/\+/g," "))}function b(){var i=T;T="hidden"==t(".pixel").css("visibility")?!1:!0,i!=T&&(O>0&&setTimeout(r,100),O++);var a=t(".states"),n=755,o=709,s=(a.width(),a.height()),c=0,c=o/n;a.width(s*c),R&&p();var l=e.innerHeight-29;t("#container").height(l),t("#svgMap").height(1.14492080419237*t("#svgMap").width()),d()}function w(e,i,a,n){t.getJSON("http://api.bitly.com/v3/shorten?callback=?",{format:"json",apiKey:a,login:i,longUrl:e},function(t){n(t.data.url)})}var C,x,B,T,k=[],I={},L=!1,E=!1,R=!1,M=new TimelineLite({onComplete:function(){L=!1,v()}}),_=new TimelineLite,O=0,U=!1,N=!1,P=encodeURIComponent("Head down the Mississippi River and see the sights with the stars of #MississippiGrind"),S="jesseseymour",j="R_176c4bf0452d433eb552ea16f469d6e3",z=function(){t("svg .state").on("click",function(){var e=t(this).attr("id");c(t("#"+e))}),t(a).on("click",".backToMap, .closeMap",r),t(a).on("click",".pin",h),t(".watchTrailer").on("click",function(){t.fancybox.open({href:"http://www.youtube.com/embed/7p1MNB6TNQU?autoplay=1"},{type:"iframe",padding:4,margin:40})}),t("#feelingLucky").mouseenter(function(){m()}).mouseleave(function(){U=!1}),t(".comments-arrow").on("click",function(){t("body").scrollTo("100px",300)}),TweenMax.set(t(".state"),{transformOrigin:"50% 50% 0"}),TweenMax.to(t(".state"),0,{scale:0}),b(),n()};e.onresize=function(){b()},e.addEventListener("orientationchange",function(){r()}),t.extend(t.fancybox.defaults.tpl,{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div><div class="logo"><div class="dice"><img class="die1" src="images/die-1.png" alt="" /><img class="die2" src="images/die-2.png" alt="" /></div><img src="images/mississippi-grind-we-cant-lose.png" alt="Mississippi Grind. We Can\'t Lose" /></div>'}),t.fancybox.defaults.nextEffect="none",t.fancybox.defaults.prevEffect="none",t.fancybox.defaults.closeBtn=!1,t(a).ready(z)}(jQuery,window,document);