!function(t,e,a){function n(){t.getJSON("../locations.json",function(e){y=e;var a=0;t.each(e.states,function(){var i=t(this)[0],n="#"+i.abbrev,o=t(n);B.push(o);var s=c(i);s&&a==e.states.length-1&&t("#detailPanelTemplate").remove(),a++}),E||o()})}function o(){x.fromTo(t(".dice > img"),2,{scale:0,rotation:-90},{scale:1,rotation:0,ease:Power3.easeOut},0),x.staggerTo(B,.8,{scale:1,ease:Back.easeOut},.2);var e=document.getElementById("riverPath"),a={length:0,pathLength:e.getTotalLength()};x.to(a,5,{length:a.pathLength,onStart:function(){e.style.display="block"},onUpdate:s,onUpdateParams:[a,e],ease:Linear.easeNone})}function s(t,e){e.style.strokeDasharray=[t.length,t.pathLength].join(" ")}function r(a){if(L)L=!1;else{a.attr("data-active","1"),C.state=a.attr("id");{var n=document.getElementById(C.state),o=n.getBoundingClientRect().width,s=(n.getBoundingClientRect().height,a.offset());t("#test")}if(w=t("#overlay"+C.state).css({left:s.left,top:s.top,width:o,opacity:0}),L=!0,I=new TimelineLite({onComplete:function(){var n=a.attr("data-x"),o=a.attr("data-y"),s=a.attr("data-scale");w.css("opacity",1),a.css("opacity",0);var r=0;E||(r=.2);var d=t(".svgContainer").offset(),c=t(".svgContainer").width(),l=t(".svgContainer").height(),f=(c*(n/100)+d.left)/t(e).width()*100,u=(l*(o/100)+d.top)/t(e).height()*100;TweenMax.to(w,r,{width:s+"%",left:f+"%",top:u+"%",svgOrigin:"0 0",onComplete:function(){for(i=0;i<y.states.length;i++)if(a.attr("id")==y.states[i].abbrev)return C.pins=y.states[i].pins,h(),void g()}})},onReverseComplete:function(){TweenLite.to(a,0,{opacity:1}),w.css({left:-1e3,top:-1e3})}}),E)return;I.to(t("#river"),.5,{opacity:0}),t(".state").each(function(){if(0==t(this).attr("data-active")){t(this).css("z-index",10);var e=0;E||(e=.3),I.to(t(this),e,{scale:0,ease:Back.easeIn},0)}})}}function d(){var e=document.getElementById(C.state),a=e.getBoundingClientRect().width,i=(e.getBoundingClientRect().height,t("#"+C.state).offset());b.reverse(),TweenMax.to(w,.2,{width:a,left:i.left,top:i.top,onComplete:function(){I.reverse()}}),t("#"+C.state).attr("data-active","0"),TweenLite.to(t("#details"),.5,{right:"-100%"}),L=!1,T=!1}function c(e){var a=0,i=e.pins;return t.each(i,function(){var i=t(this)[0],n=t("<div>").addClass("pin pin_"+e.abbrev).attr({"data-pinid":a,"data-state":e.abbrev,"data-x":t(this)[0].x,"data-y":t(this)[0].y}).append("<img src='images/pin.png' />");"red"===t(this)[0].color&&n.addClass("red"),t(".container").append(n);var o=t("#detailPanelTemplate").clone(!0).attr({id:"panel_"+e.abbrev+"_"+a,"data-state":e.abbrev,"data-id":a});t(".city",o).text(i.city+", "+e.state),t(".a1",o).text(i.name),t(".a2",o).text(i.address),t(".a3",o).text(i.city+", "+e.abbrev+", "+i.zip),t(".video",o).attr("data-ytid",i.ytid),t(".photo",o).attr("data-featherlight",i.images[0]),t(".thumb",o).html('<img src="/images/thumbs/'+i.thumb+'" />'),t("#details").append(o),a++}),!0}function l(){var t=(document.getElementById("river").getBoundingClientRect(),document.getElementById("svgMap").getBoundingClientRect()),e=.466*t.width,a=2.44505907782121*e;document.getElementById("river").style.width=e,document.getElementById("river").style.height=a,document.getElementById("river").style.left=t.left+.2849869862426*t.width,document.getElementById("river").style.top=t.top-.122*t.height}function h(){var e=document.getElementById("overlay"+C.state),a=e.getBoundingClientRect().width,i=e.getBoundingClientRect().height,n=w.offset();t.each(t(".pin_"+C.state),function(){var e=a*t(this).attr("data-x"),o=i*t(this).attr("data-y"),s=n.left+e-t(this).width()/2,r=n.top+o-t(this).height();t(this).css({left:s,top:r})})}function g(){b=new TimelineLite({onReverseComplete:function(){this.clear()}});var e=[];t.each(t(".pin_"+C.state),function(){e.push(t(this))}),E||b.staggerFrom(e,.5,{top:-100},.1).to(t(this),.5,{alpha:1},.5)}function f(){var e=t(this),a=e.attr("data-state"),i=e.attr("data-pinid"),n=t("#panel_"+a+"_"+i);T?TweenLite.to(t("#details"),.5,{right:"-100%",onComplete:function(){u(n)}}):u(n),T=!0}function u(e){v(),e.css("visibility","visible"),TweenLite.to(t("#details"),.5,{right:"3%"})}function v(){t(".panel").css("visibility","hidden")}function p(){var e=t(".states"),a=755,i=709,n=(e.width(),e.height()),o=0,o=i/a;e.width(n*o),L&&h(),l()}function m(){var e=t(this).attr("data-ytid"),a="<div class='embed-container'><iframe src='http://www.youtube.com/embed/"+e+"' frameborder='0' allowfullscreen></iframe></div>";t.featherlight(a)}var y,w,b,B=[],C={},T=!1,L=!1,x=new TimelineLite,I=new TimelineLite,E=!1,R=function(){t("svg .state").on("click",function(){var e=t(this).attr("id");r(t("#"+e))}),E&&r(t("#LA")),t(a).on("click",".backToMap",d),t(a).on("click",".pin",f),t(a).on("click",".video",m),TweenMax.set(t(".state"),{transformOrigin:"50% 50% 0"}),E||TweenMax.to(t(".state"),0,{scale:0}),p(),n()};e.onresize=function(){p()},t.featherlight.defaults.variant="mg",t.featherlight.defaults.closeIcon="X",t(a).ready(R)}(jQuery,window,document);